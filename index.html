<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CosmosChat - Connect Across the Universe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'spin-slow': 'spin 20s linear infinite',
                        'bounce-slow': 'bounce 3s infinite',
                        'pulse-slow': 'pulse 4s infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'slide-down': 'slideDown 0.5s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px rgba(147, 51, 234, 0.3)' },
                            '100%': { boxShadow: '0 0 40px rgba(147, 51, 234, 0.6)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' },
                        },
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .bg-gradient-radial {
            background: radial-gradient(var(--tw-gradient-stops));
        }
        
        .cosmic-glow {
            box-shadow: 0 0 30px rgba(147, 51, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .cosmic-glow:hover {
            box-shadow: 0 0 50px rgba(147, 51, 234, 0.6);
            transform: translateY(-2px);
        }
        
        .message-bubble {
            animation: slideUp 0.3s ease-out;
        }
        
        .typing-indicator {
            animation: pulse 1.5s infinite;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .planet {
            position: absolute;
            border-radius: 50%;
            opacity: 0.7;
            filter: blur(0.5px);
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .video-call-overlay {
            backdrop-filter: blur(15px);
            background: rgba(0, 0, 0, 0.85);
        }
        
        .profile-picture {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .profile-picture:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 0 40px rgba(147, 51, 234, 0.6);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.4);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .friend-item {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .friend-item:hover {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(59, 130, 246, 0.1));
            border-color: rgba(147, 51, 234, 0.3);
            transform: translateX(5px);
        }
        
        .input-cosmic {
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .input-cosmic:focus {
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.3);
            transform: scale(1.02);
        }
        
        .notification {
            animation: slideDown 0.5s ease-out;
        }
        
        .modal-backdrop {
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            animation: scaleIn 0.3s ease-out;
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
        }
        
        .cosmic-border {
            background: linear-gradient(45deg, #06b6d4, #8b5cf6, #ec4899, #06b6d4);
            background-size: 300% 300%;
            animation: gradient-shift 3s ease infinite;
        }
        
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .message-user {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
        }
        
        .message-friend {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.3), rgba(59, 130, 246, 0.3));
            backdrop-filter: blur(10px);
        }
        
        .status-online {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }
        
        .status-offline {
            background: #6b7280;
        }
        
        .call-button {
            transition: all 0.3s ease;
        }
        
        .call-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.5);
        }
        
        .avatar-ring {
            background: conic-gradient(from 0deg, #06b6d4, #8b5cf6, #ec4899, #06b6d4);
            animation: spin 3s linear infinite;
        }
        
        .loading-spinner {
            border: 3px solid rgba(147, 51, 234, 0.3);
            border-top: 3px solid #8b5cf6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        .call-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        .incoming-call {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideDown 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-950 via-purple-950 to-black min-h-screen overflow-hidden">
    <!-- Animated Stars Background -->
    <div id="stars-container" class="fixed inset-0 pointer-events-none z-0"></div>
    
    <!-- Floating Planets -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="planet w-20 h-20 bg-gradient-to-br from-orange-400 to-red-500 top-16 left-8 animate-float"></div>
        <div class="planet w-14 h-14 bg-gradient-to-br from-blue-400 to-cyan-500 top-32 right-16 animate-pulse-slow"></div>
        <div class="planet w-24 h-24 bg-gradient-to-br from-purple-400 to-pink-500 bottom-24 left-1/4 animate-spin-slow"></div>
        <div class="planet w-10 h-10 bg-gradient-to-br from-yellow-400 to-orange-500 bottom-16 right-1/3 animate-bounce-slow"></div>
        <div class="planet w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-500 top-1/2 left-12 animate-float" style="animation-delay: 2s;"></div>
    </div>

    <!-- Landing Page -->
    <div id="landing-page" class="relative z-10 flex flex-col items-center justify-center min-h-screen px-4">
        <div class="text-center mb-16 animate-fade-in">
            <div class="flex items-center justify-center mb-8">
                <div class="relative">
                    <div class="avatar-ring w-20 h-20 rounded-full p-1">
                        <div class="w-full h-full bg-gradient-to-br from-cyan-400 to-purple-600 rounded-full flex items-center justify-center">
                            <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="absolute -top-2 -right-2 w-8 h-8 bg-yellow-400 rounded-full animate-ping"></div>
                </div>
            </div>
            
            <h1 class="text-7xl md:text-9xl font-black bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-6 animate-glow">
                CosmosChat
            </h1>
            
            <p class="text-2xl md:text-3xl text-gray-300 mb-12 max-w-3xl mx-auto leading-relaxed">
                Connect across the universe with friends in real-time. Share messages, images, and explore the cosmos together.
            </p>
        </div>

        <!-- Enhanced Feature Cards -->
        <div class="grid md:grid-cols-3 gap-8 mb-16 max-w-6xl w-full">
            <div class="glass-effect p-8 rounded-2xl card-hover cosmic-glow">
                <div class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl flex items-center justify-center mb-6">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-white mb-4">Connect with Friends</h3>
                <p class="text-gray-300 text-lg leading-relaxed">Create your cosmic profile and connect with friends across the galaxy using unique Cosmic IDs.</p>
            </div>

            <div class="glass-effect p-8 rounded-2xl card-hover cosmic-glow">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center mb-6">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-white mb-4">Real-time Messaging</h3>
                <p class="text-gray-300 text-lg leading-relaxed">Chat instantly with friends using our stellar messaging system with typing indicators and read receipts.</p>
            </div>

            <div class="glass-effect p-8 rounded-2xl card-hover cosmic-glow">
                <div class="w-16 h-16 bg-gradient-to-br from-pink-500 to-red-600 rounded-2xl flex items-center justify-center mb-6">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-white mb-4">Voice & Video Calls</h3>
                <p class="text-gray-300 text-lg leading-relaxed">Connect face-to-face with cosmic video and voice calling featuring HD quality and crystal clear audio.</p>
            </div>
        </div>

        <!-- Enhanced CTA Buttons -->
        <div class="flex flex-col sm:flex-row gap-6">
            <button onclick="showSignup()" class="btn-primary text-white px-12 py-4 text-xl font-bold rounded-2xl shadow-2xl">
                <svg class="w-6 h-6 inline mr-3" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                </svg>
                Join the Universe
            </button>
            
            <button onclick="showLogin()" class="glass-effect border-2 border-purple-400 text-purple-300 hover:text-white px-12 py-4 text-xl font-bold rounded-2xl transition-all duration-300 hover:scale-105 hover:bg-purple-500/20">
                <svg class="w-6 h-6 inline mr-3" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                </svg>
                Launch Mission
            </button>
        </div>
    </div>

    <!-- Enhanced Login Page -->
    <div id="login-page" class="hidden relative z-10 flex items-center justify-center min-h-screen p-4">
        <div class="w-full max-w-lg animate-scale-in">
            <button onclick="showLanding()" class="inline-flex items-center text-purple-300 hover:text-purple-200 mb-8 transition-all duration-300 hover:translate-x-2">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Back to Universe
            </button>

            <div class="glass-effect rounded-3xl p-8 shadow-2xl cosmic-glow">
                <div class="text-center mb-8">
                    <div class="flex justify-center mb-6">
                        <div class="avatar-ring w-16 h-16 rounded-full p-1">
                            <div class="w-full h-full bg-gradient-to-br from-cyan-400 to-purple-600 rounded-full flex items-center justify-center">
                                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <h2 class="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent mb-2">
                        Welcome Back, Explorer
                    </h2>
                    <p class="text-gray-300 text-lg">Continue your cosmic journey</p>
                </div>

                <form id="login-form" class="space-y-6">
                    <div class="space-y-2">
                        <label class="text-gray-200 flex items-center text-lg font-medium">
                            <svg class="w-5 h-5 mr-3 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
                            </svg>
                            Galactic Email
                        </label>
                        <input type="email" id="login-email" placeholder="your@galaxy.com" required
                               class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50">
                    </div>

                    <div class="space-y-2">
                        <label class="text-gray-200 flex items-center text-lg font-medium">
                            <svg class="w-5 h-5 mr-3 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                            </svg>
                            Secret Code
                        </label>
                        <input type="password" id="login-password" placeholder="Enter your secret code" required
                               class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50">
                    </div>

                    <button type="submit" class="w-full btn-primary text-white font-bold py-4 text-lg rounded-xl shadow-2xl">
                        <svg class="w-5 h-5 inline mr-3" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                        </svg>
                        Launch Mission
                    </button>
                </form>

                <div class="mt-8 text-center">
                    <p class="text-gray-300 text-lg">
                        New to the cosmos? 
                        <button onclick="showSignup()" class="text-cyan-400 hover:text-cyan-300 font-bold transition-colors">
                            Join the Universe
                        </button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Signup Page -->
    <div id="signup-page" class="hidden relative z-10 flex items-center justify-center min-h-screen p-4">
        <div class="w-full max-w-lg animate-scale-in">
            <button onclick="showLanding()" class="inline-flex items-center text-purple-300 hover:text-purple-200 mb-8 transition-all duration-300 hover:translate-x-2">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Back to Universe
            </button>

            <div class="glass-effect rounded-3xl p-8 shadow-2xl cosmic-glow">
                <div class="text-center mb-8">
                    <div class="flex justify-center mb-6">
                        <div class="avatar-ring w-16 h-16 rounded-full p-1">
                            <div class="w-full h-full bg-gradient-to-br from-cyan-400 to-purple-600 rounded-full flex items-center justify-center">
                                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <h2 class="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent mb-2">
                        Join the Cosmos
                    </h2>
                    <p class="text-gray-300 text-lg">Create your cosmic profile and start exploring</p>
                </div>

                <form id="signup-form" class="space-y-6">
                    <div class="space-y-2">
                        <label class="text-gray-200 flex items-center text-lg font-medium">
                            <svg class="w-5 h-5 mr-3 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            Cosmic Username
                        </label>
                        <input type="text" id="signup-username" placeholder="Enter your cosmic name" required
                               class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50">
                    </div>

                    <div class="space-y-2">
                        <label class="text-gray-200 flex items-center text-lg font-medium">
                            <svg class="w-5 h-5 mr-3 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
                            </svg>
                            Galactic Email
                        </label>
                        <input type="email" id="signup-email" placeholder="your@galaxy.com" required
                               class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50">
                    </div>

                    <div class="space-y-2">
                        <label class="text-gray-200 flex items-center text-lg font-medium">
                            <svg class="w-5 h-5 mr-3 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                            </svg>
                            Secret Code
                        </label>
                        <input type="password" id="signup-password" placeholder="Enter your secret code" required
                               class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50">
                    </div>

                    <button type="submit" class="w-full btn-primary text-white font-bold py-4 text-lg rounded-xl shadow-2xl">
                        <svg class="w-5 h-5 inline mr-3" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                        </svg>
                        Launch into Space
                    </button>
                </form>

                <div class="mt-8 text-center">
                    <p class="text-gray-300 text-lg">
                        Already have a cosmic account? 
                        <button onclick="showLogin()" class="text-cyan-400 hover:text-cyan-300 font-bold transition-colors">
                            Sign In
                        </button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Dashboard -->
    <div id="dashboard" class="hidden relative z-10 p-6 animate-fade-in">
        <!-- Enhanced Header -->
        <div class="flex items-center justify-between mb-10">
            <div class="flex items-center space-x-6">
                <div class="relative">
                    <div id="user-avatar" class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-purple-500 rounded-2xl flex items-center justify-center text-white font-bold text-2xl profile-picture cursor-pointer cosmic-glow" onclick="showProfile()">
                        U
                    </div>
                    <div class="absolute -bottom-1 -right-1 w-5 h-5 status-online border-3 border-black rounded-full"></div>
                </div>
                <div>
                    <h1 id="welcome-text" class="text-3xl font-bold text-white mb-1">Welcome back!</h1>
                    <p class="text-gray-300 text-lg">Ready to explore the cosmos?</p>
                    <p id="user-cosmic-id" class="text-sm text-cyan-400 font-mono"></p>
                </div>
            </div>

            <div class="flex items-center space-x-3">
                <button onclick="showProfile()" class="glass-effect border border-purple-500/30 text-purple-300 hover:text-white p-3 rounded-xl transition-all duration-300 hover:scale-110 call-button">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </button>
                <button onclick="logout()" class="glass-effect border border-red-500/30 text-red-300 hover:text-white p-3 rounded-xl transition-all duration-300 hover:scale-110 call-button">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Enhanced Stats Cards -->
        <div class="grid md:grid-cols-3 gap-8 mb-10">
            <div class="glass-effect rounded-2xl p-8 card-hover cosmic-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-lg font-medium">Active Chats</p>
                        <p id="active-chats-count" class="text-4xl font-bold text-white mt-2">0</p>
                    </div>
                    <div class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl flex items-center justify-center">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="glass-effect rounded-2xl p-8 card-hover cosmic-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-lg font-medium">Cosmic Friends</p>
                        <p id="friends-count" class="text-4xl font-bold text-white mt-2">0</p>
                    </div>
                    <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="glass-effect rounded-2xl p-8 card-hover cosmic-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-300 text-lg font-medium">Cosmic Points</p>
                        <p class="text-4xl font-bold text-white mt-2">1,247</p>
                    </div>
                    <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-2xl flex items-center justify-center">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Friends List -->
        <div class="glass-effect rounded-2xl cosmic-glow">
            <div class="p-8 border-b border-purple-500/30">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        <svg class="w-6 h-6 mr-3 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                        </svg>
                        Cosmic Friends
                    </h2>
                    <button onclick="showAddFriend()" class="btn-primary text-white px-6 py-3 rounded-xl text-lg font-bold">
                        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Add Friend
                    </button>
                </div>
            </div>
            <div id="friends-list" class="p-8">
                <div class="text-center text-gray-400 py-12">
                    <svg class="w-20 h-20 mx-auto mb-6 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                    </svg>
                    <p class="text-xl">No cosmic friends yet. Start exploring the universe!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Profile Modal -->
    <div id="profile-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 modal-backdrop">
        <div class="glass-effect rounded-3xl p-8 w-full max-w-lg modal-content cosmic-glow">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-white">Cosmic Profile</h2>
                <button onclick="hideProfile()" class="text-gray-400 hover:text-white transition-colors call-button">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="text-center mb-8">
                <div class="relative inline-block">
                    <div id="profile-avatar" class="w-32 h-32 bg-gradient-to-br from-cyan-500 to-purple-500 rounded-3xl flex items-center justify-center text-white font-bold text-4xl profile-picture cursor-pointer cosmic-glow" onclick="document.getElementById('avatar-input').click()">
                        U
                    </div>
                    <input type="file" id="avatar-input" accept="image/*" class="hidden" onchange="updateAvatar(this)">
                    <div class="absolute -bottom-3 -right-3 bg-purple-500 text-white rounded-2xl p-3 cursor-pointer call-button" onclick="document.getElementById('avatar-input').click()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                </div>
                <p class="text-gray-300 text-lg mt-4">Click to change avatar</p>
            </div>

            <form id="profile-form" class="space-y-6">
                <div>
                    <label class="text-gray-200 text-lg font-medium">Username</label>
                    <input type="text" id="profile-username" class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50 mt-2">
                </div>

                <div>
                    <label class="text-gray-200 text-lg font-medium">Bio</label>
                    <textarea id="profile-bio" placeholder="Tell the universe about yourself..." rows="4" class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50 mt-2 resize-none"></textarea>
                </div>

                <div>
                    <label class="text-gray-200 text-lg font-medium">Your Cosmic ID</label>
                    <div class="flex items-center space-x-3 mt-2">
                        <input type="text" id="profile-id" readonly class="flex-1 input-cosmic border border-purple-500/30 text-gray-300 rounded-xl px-6 py-4 text-lg">
                        <button type="button" onclick="copyUserId()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-4 rounded-xl transition-all duration-300 hover:scale-105 call-button">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                        </button>
                    </div>
                    <p class="text-gray-400 text-sm mt-2">Share this ID with friends to connect</p>
                </div>

                <button type="submit" class="w-full btn-primary text-white font-bold py-4 text-lg rounded-xl shadow-2xl">
                    Save Changes
                </button>
            </form>
        </div>
    </div>

    <!-- Enhanced Add Friend Modal -->
    <div id="add-friend-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 modal-backdrop">
        <div class="glass-effect rounded-3xl p-8 w-full max-w-lg modal-content cosmic-glow">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-white">Add Cosmic Friend</h2>
                <button onclick="hideAddFriend()" class="text-gray-400 hover:text-white transition-colors call-button">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <form id="add-friend-form" class="space-y-6">
                <div>
                    <label class="text-gray-200 text-lg font-medium">Friend's Cosmic ID</label>
                    <input type="text" id="friend-identifier" placeholder="Enter their Cosmic ID (e.g., cosmic_abc123def456)" required class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50 mt-2">
                    <p class="text-gray-400 text-sm mt-2">Ask your friend to share their Cosmic ID from their profile</p>
                </div>

                <button type="submit" class="w-full btn-primary text-white font-bold py-4 text-lg rounded-xl shadow-2xl">
                    <svg class="w-5 h-5 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Add Friend
                </button>
            </form>
        </div>
    </div>

    <!-- Enhanced Chat Interface -->
    <div id="chat-interface" class="hidden relative z-10 flex flex-col h-screen animate-fade-in">
        <!-- Enhanced Chat Header -->
        <div class="glass-effect border-b border-purple-500/30 p-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <button onclick="backToDashboard()" class="text-purple-300 hover:text-purple-200 hover:bg-purple-500/20 p-3 rounded-xl transition-all duration-300 call-button">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>

                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <div id="chat-friend-avatar" class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center text-white font-bold text-xl">
                                F
                            </div>
                            <div id="chat-friend-status" class="absolute -bottom-1 -right-1 w-4 h-4 border-3 border-black rounded-full status-online"></div>
                        </div>
                        <div>
                            <h2 id="chat-friend-name" class="font-bold text-white text-xl">Friend</h2>
                            <div class="flex items-center space-x-3">
                                <span id="chat-friend-status-text" class="text-sm text-green-300 bg-green-500/20 border border-green-500/30 px-3 py-1 rounded-full">online</span>
                                <span id="typing-indicator" class="text-sm text-cyan-400 animate-pulse hidden">typing...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-3">
                    <button onclick="startVoiceCall()" class="glass-effect text-purple-300 hover:text-white p-3 rounded-xl transition-all duration-300 call-button">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </button>
                    <button onclick="startVideoCall()" class="glass-effect text-purple-300 hover:text-white p-3 rounded-xl transition-all duration-300 call-button">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Enhanced Messages Area -->
        <div id="messages-container" class="flex-1 overflow-y-auto p-6 space-y-4 scrollbar-hide">
            <!-- Messages will be dynamically added here -->
        </div>

        <!-- Enhanced Message Input -->
        <div class="glass-effect border-t border-purple-500/30 p-6">
            <div class="flex items-center space-x-4">
                <input type="file" id="image-input" accept="image/*" class="hidden" onchange="sendImage(this)">
                
                <button onclick="document.getElementById('image-input').click()" class="glass-effect text-purple-300 hover:text-white p-3 rounded-xl transition-all duration-300 call-button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </button>

                <div class="flex-1 relative">
                    <input type="text" id="message-input" placeholder="Type your cosmic message..." class="w-full input-cosmic border border-purple-500/30 text-white placeholder-gray-400 focus:border-cyan-400 rounded-xl px-6 py-4 pr-14 text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400/50">
                    <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-300 hover:text-white p-2 rounded-lg transition-colors call-button">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.01M15 10h1.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </button>
                </div>

                <button onclick="sendMessage()" class="btn-primary text-white p-4 rounded-xl shadow-2xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Video Call Overlay -->
    <div id="video-call-overlay" class="hidden fixed inset-0 video-call-overlay z-50 flex items-center justify-center p-6">
        <div class="glass-effect rounded-3xl p-8 w-full max-w-6xl cosmic-glow">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-white">Cosmic Video Call</h2>
                <div class="flex items-center space-x-4">
                    <span id="call-timer" class="text-cyan-400 font-mono text-xl">00:00</span>
                    <button onclick="endCall()" class="bg-red-500 hover:bg-red-600 text-white p-3 rounded-2xl transition-all duration-300 hover:scale-110">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 3l18 18"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="relative bg-black/50 rounded-2xl overflow-hidden aspect-video">
                    <video id="local-video" autoplay muted class="w-full h-full object-cover"></video>
                    <div class="absolute bottom-4 left-4 bg-black/70 text-white px-4 py-2 rounded-xl text-lg font-medium">You</div>
                </div>
                <div class="relative bg-black/50 rounded-2xl overflow-hidden aspect-video">
                    <video id="remote-video" autoplay class="w-full h-full object-cover"></video>
                    <div id="remote-video-label" class="absolute bottom-4 left-4 bg-black/70 text-white px-4 py-2 rounded-xl text-lg font-medium">Friend</div>
                </div>
            </div>

            <div class="flex items-center justify-center space-x-6">
                <button id="mute-btn" onclick="toggleMute()" class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-2xl transition-all duration-300 hover:scale-110 call-button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                    </svg>
                </button>
                <button id="video-btn" onclick="toggleVideo()" class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-2xl transition-all duration-300 hover:scale-110 call-button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                </button>
                <button onclick="endCall()" class="bg-red-500 hover:bg-red-600 text-white p-4 rounded-2xl transition-all duration-300 hover:scale-110 call-button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 3l18 18"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Incoming Call Notification -->
    <div id="incoming-call" class="hidden incoming-call glass-effect rounded-2xl p-6 w-80">
        <div class="flex items-center space-x-4 mb-4">
            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center text-white font-bold">
                F
            </div>
            <div>
                <h3 class="text-white font-bold">Incoming Call</h3>
                <p id="caller-name" class="text-gray-300">Friend</p>
            </div>
        </div>
        <div class="flex space-x-3">
            <button onclick="acceptCall()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-bold">
                Accept
            </button>
            <button onclick="declineCall()" class="flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl font-bold">
                Decline
            </button>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null
        let friends = []
        let currentChat = null
        let messages = {}
        let isInCall = false
        let callTimer = null
        let callStartTime = null
        let localStream = null
        let remoteStream = null
        let registeredUsers = {}
        let peerConnection = null

        // Initialize the app
        document.addEventListener("DOMContentLoaded", () => {
            createStars()
            loadRegisteredUsers()
            checkAuthStatus()
            setupEventListeners()
            initializeAnimations()
        })

        // Create animated stars with enhanced effects
        function createStars() {
            const starsContainer = document.getElementById("stars-container")
            for (let i = 0; i < 150; i++) {
                const star = document.createElement("div")
                star.className = "star"
                const size = Math.random() * 4 + 1
                star.style.width = size + "px"
                star.style.height = size + "px"
                star.style.left = Math.random() * 100 + "%"
                star.style.top = Math.random() * 100 + "%"
                star.style.animationDelay = Math.random() * 3 + "s"
                star.style.animationDuration = 2 + Math.random() * 4 + "s"
                starsContainer.appendChild(star)
            }
        }

        // Load registered users from localStorage
        function loadRegisteredUsers() {
            const saved = localStorage.getItem("cosmosRegisteredUsers")
            if (saved) {
                registeredUsers = JSON.parse(saved)
            }
        }

        // Save registered users to localStorage
        function saveRegisteredUsers() {
            localStorage.setItem("cosmosRegisteredUsers", JSON.stringify(registeredUsers))
        }

        // Initialize animations and effects
        function initializeAnimations() {
            document.body.style.transition = "all 0.3s ease"

            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = "1"
                        entry.target.style.transform = "translateY(0)"
                    }
                })
            })

            document.querySelectorAll(".card-hover").forEach((el) => {
                el.style.opacity = "0"
                el.style.transform = "translateY(20px)"
                el.style.transition = "all 0.6s ease"
                observer.observe(el)
            })
        }

        // Enhanced event listeners
        function setupEventListeners() {
            document.getElementById("login-form").addEventListener("submit", handleLogin)
            document.getElementById("signup-form").addEventListener("submit", handleSignup)
            document.getElementById("profile-form").addEventListener("submit", handleProfileUpdate)
            document.getElementById("add-friend-form").addEventListener("submit", handleAddFriend)

            const messageInput = document.getElementById("message-input")
            messageInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault()
                    sendMessage()
                }
            })

            messageInput.addEventListener("input", () => {
                if (currentChat) {
                    simulateTypingIndicator()
                }
            })

            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") {
                    hideAllModals()
                }

                if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
                    sendMessage()
                }
            })

            document.addEventListener("click", (e) => {
                if (e.target.classList.contains("modal-backdrop")) {
                    hideAllModals()
                }
            })
        }

        // Enhanced authentication status check
        function checkAuthStatus() {
            showLoadingState()

            setTimeout(() => {
                const userData = localStorage.getItem("cosmosUser")
                if (userData) {
                    currentUser = JSON.parse(userData)
                    // Verify user still exists in registered users
                    if (registeredUsers[currentUser.email]) {
                        loadUserData()
                        showDashboard()
                    } else {
                        // User was deleted, logout
                        logout()
                    }
                } else {
                    showLanding()
                }
                hideLoadingState()
            }, 1000)
        }

        // Loading states
        function showLoadingState() {
            const loader = document.createElement("div")
            loader.id = "global-loader"
            loader.className = "fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center"
            loader.innerHTML = `
                <div class="text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-white text-xl">Initializing Cosmos...</p>
                </div>
            `
            document.body.appendChild(loader)
        }

        function hideLoadingState() {
            const loader = document.getElementById("global-loader")
            if (loader) {
                loader.style.opacity = "0"
                setTimeout(() => loader.remove(), 300)
            }
        }

        // Enhanced navigation with smooth transitions
        function showLanding() {
            hideAllPages()
            const landing = document.getElementById("landing-page")
            landing.classList.remove("hidden")
            landing.style.animation = "fadeIn 0.5s ease-out"
        }

        function showLogin() {
            hideAllPages()
            const login = document.getElementById("login-page")
            login.classList.remove("hidden")
            login.style.animation = "slideUp 0.5s ease-out"
            document.getElementById("login-email").focus()
        }

        function showSignup() {
            hideAllPages()
            const signup = document.getElementById("signup-page")
            signup.classList.remove("hidden")
            signup.style.animation = "slideUp 0.5s ease-out"
            document.getElementById("signup-username").focus()
        }

        function showDashboard() {
            hideAllPages()
            const dashboard = document.getElementById("dashboard")
            dashboard.classList.remove("hidden")
            dashboard.style.animation = "fadeIn 0.5s ease-out"
            updateDashboard()
        }

        function showChat(friendId) {
            hideAllPages()
            const chat = document.getElementById("chat-interface")
            chat.classList.remove("hidden")
            chat.style.animation = "slideUp 0.5s ease-out"
            loadChat(friendId)
        }

        function hideAllPages() {
            const pages = ["landing-page", "login-page", "signup-page", "dashboard", "chat-interface"]
            pages.forEach((page) => {
                document.getElementById(page).classList.add("hidden")
            })
        }

        function hideAllModals() {
            const modals = ["profile-modal", "add-friend-modal", "video-call-overlay", "incoming-call"]
            modals.forEach((modal) => {
                const element = document.getElementById(modal)
                if (!element.classList.contains("hidden")) {
                    element.style.animation = "fadeOut 0.3s ease-out"
                    setTimeout(() => element.classList.add("hidden"), 300)
                }
            })
        }

        // Enhanced authentication with proper validation
        function handleLogin(e) {
            e.preventDefault()

            const email = document.getElementById("login-email").value.trim()
            const password = document.getElementById("login-password").value

            if (!validateEmail(email)) {
                showNotification("Please enter a valid galactic email address", "error")
                return
            }

            if (password.length < 6) {
                showNotification("Secret code must be at least 6 characters", "error")
                return
            }

            setButtonLoading(e.target.querySelector('button[type="submit"]'), true)

            // Check if user exists and password matches
            setTimeout(() => {
                const registeredUser = registeredUsers[email]
                
                if (!registeredUser) {
                    setButtonLoading(e.target.querySelector('button[type="submit"]'), false)
                    showNotification("No account found with this email. Please sign up first! ", "error")
                    return
                }

                if (registeredUser.password !== password) {
                    setButtonLoading(e.target.querySelector('button[type="submit"]'), false)
                    showNotification("Incorrect secret code. Please try again! ", "error")
                    return
                }

                // Login successful
                currentUser = {
                    id: registeredUser.id,
                    username: registeredUser.username,
                    email: registeredUser.email,
                    bio: registeredUser.bio,
                    avatar: registeredUser.avatar,
                    joinDate: registeredUser.joinDate,
                    lastSeen: new Date().toISOString(),
                }

                localStorage.setItem("cosmosUser", JSON.stringify(currentUser))
                loadUserData()

                setButtonLoading(e.target.querySelector('button[type="submit"]'), false)
                showNotification("Welcome back to the cosmos! ", "success")
                showDashboard()
            }, 2000)
        }

        function handleSignup(e) {
            e.preventDefault()

            const username = document.getElementById("signup-username").value.trim()
            const email = document.getElementById("signup-email").value.trim()
            const password = document.getElementById("signup-password").value

            if (!validateUsername(username)) {
                showNotification("Username must be 3-20 characters and contain only letters, numbers, and underscores", "error")
                return
            }

            if (!validateEmail(email)) {
                showNotification("Please enter a valid galactic email address", "error")
                return
            }

            if (password.length < 6) {
                showNotification("Secret code must be at least 6 characters", "error")
                return
            }

            // Check if user already exists
            if (registeredUsers[email]) {
                showNotification("An account with this email already exists. Please login instead! ", "error")
                return
            }

            setButtonLoading(e.target.querySelector('button[type="submit"]'), true)

            setTimeout(() => {
                const userId = generateUserId()
                const userData = {
                    id: userId,
                    username: username,
                    email: email,
                    password: password, // In real app, this would be hashed
                    bio: "New cosmic explorer! ",
                    avatar: null,
                    joinDate: new Date().toISOString(),
                    lastSeen: new Date().toISOString(),
                }

                // Register the user
                registeredUsers[email] = userData
                saveRegisteredUsers()

                // Set as current user
                currentUser = { ...userData }
                delete currentUser.password // Don't store password in current session
                localStorage.setItem("cosmosUser", JSON.stringify(currentUser))
                loadUserData()

                setButtonLoading(e.target.querySelector('button[type="submit"]'), false)
                showNotification(`Welcome to the cosmos, ${username}! `, "success")
                showDashboard()
            }, 2000)
        }

        function logout() {
            if (confirm("Are you sure you want to leave the cosmos?")) {
                localStorage.removeItem("cosmosUser")
                localStorage.removeItem("cosmosFriends")
                localStorage.removeItem("cosmosMessages")
                currentUser = null
                friends = []
                messages = {}
                showNotification("See you in the stars! ", "info")
                showLanding()
            }
        }

        // Enhanced validation functions
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
            return emailRegex.test(email)
        }

        function validateUsername(username) {
            const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/
            return usernameRegex.test(username)
        }

        // Enhanced user data management
        function loadUserData() {
            if (!currentUser) return

            const savedFriends = localStorage.getItem("cosmosFriends")
            if (savedFriends) {
                friends = JSON.parse(savedFriends)
                // Update friend statuses randomly for demo
                friends.forEach((friend) => {
                    friend.status = Math.random() > 0.3 ? "online" : "offline"
                    friend.lastSeen = new Date(Date.now() - Math.random() * 86400000).toISOString()
                })
            }

            const savedMessages = localStorage.getItem("cosmosMessages")
            if (savedMessages) {
                messages = JSON.parse(savedMessages)
            }
        }

        function saveUserData() {
            if (currentUser) {
                currentUser.lastSeen = new Date().toISOString()
                localStorage.setItem("cosmosUser", JSON.stringify(currentUser))
            }
            localStorage.setItem("cosmosFriends", JSON.stringify(friends))
            localStorage.setItem("cosmosMessages", JSON.stringify(messages))
        }

        function generateUserId() {
            return "cosmic_" + Math.random().toString(36).substr(2, 12)
        }

        // Enhanced dashboard with real-time updates
        function updateDashboard() {
            if (!currentUser) return

            const hour = new Date().getHours()
            let greeting = "Welcome back"
            if (hour < 12) greeting = "Good morning"
            else if (hour < 18) greeting = "Good afternoon"
            else greeting = "Good evening"

            document.getElementById("welcome-text").textContent = `${greeting}, ${currentUser.username}!`
            document.getElementById("user-cosmic-id").textContent = `ID: ${currentUser.id}`

            updateUserAvatar()
            updateStatsWithAnimation()
            updateFriendsList()
        }

        function updateUserAvatar() {
            const avatar = document.getElementById("user-avatar")
            if (currentUser.avatar) {
                avatar.style.backgroundImage = `url(${currentUser.avatar})`
                avatar.style.backgroundSize = "cover"
                avatar.style.backgroundPosition = "center"
                avatar.textContent = ""
            } else {
                avatar.style.backgroundImage = ""
                avatar.textContent = currentUser.username.charAt(0).toUpperCase()
            }
        }

        function updateStatsWithAnimation() {
            const friendsCount = document.getElementById("friends-count")
            const activeChatsCount = document.getElementById("active-chats-count")

            animateNumber(friendsCount, friends.length)
            animateNumber(activeChatsCount, Object.keys(messages).length)
        }

        function animateNumber(element, targetNumber) {
            const currentNumber = parseInt(element.textContent) || 0
            const increment = targetNumber > currentNumber ? 1 : -1
            const duration = 1000
            const steps = Math.abs(targetNumber - currentNumber)
            const stepDuration = duration / steps

            let current = currentNumber
            const timer = setInterval(() => {
                current += increment
                element.textContent = current

                if (current === targetNumber) {
                    clearInterval(timer)
                }
            }, stepDuration)
        }

        // Enhanced friends list with better UI
        function updateFriendsList() {
            const friendsList = document.getElementById("friends-list")

            if (friends.length === 0) {
                friendsList.innerHTML = `
                    <div class="text-center text-gray-400 py-16 animate-fade-in">
                        <div class="w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-purple-500/20 to-cyan-500/20 rounded-3xl flex items-center justify-center">
                            <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">No cosmic friends yet</h3>
                        <p class="text-lg">Start exploring the universe and connect with fellow space travelers!</p>
                        <button onclick="showAddFriend()" class="mt-6 btn-primary text-white px-6 py-3 rounded-xl font-semibold">
                            Add Your First Friend
                        </button>
                    </div>
                `
                return
            }

            friendsList.innerHTML = friends
                .map((friend, index) => {
                    const lastMessage = messages[friend.id] ? messages[friend.id][messages[friend.id].length - 1] : null
                    const unreadCount = getUnreadCount(friend.id)
                    const isOnline = friend.status === "online"
                    const lastSeen = friend.lastSeen ? new Date(friend.lastSeen) : new Date()
                    const timeAgo = getTimeAgo(lastSeen)

                    return `
                        <div onclick="showChat('${friend.id}')" 
                             class="friend-item flex items-center justify-between p-6 rounded-2xl cursor-pointer mb-4 animate-fade-in"
                             style="animation-delay: ${index * 0.1}s">
                            <div class="flex items-center space-x-4">
                                <div class="relative">
                                    <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center text-white font-bold text-lg overflow-hidden">
                                        ${friend.avatar ? `<img src="${friend.avatar}" class="w-full h-full object-cover">` : friend.username.charAt(0).toUpperCase()}
                                    </div>
                                    <div class="absolute -bottom-1 -right-1 w-4 h-4 border-3 border-black rounded-full ${isOnline ? "status-online" : "status-offline"}"></div>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2">
                                        <h3 class="font-bold text-white text-lg">${friend.username}</h3>
                                        ${unreadCount > 0 ? `<span class="bg-cyan-500 text-white text-xs px-2 py-1 rounded-full font-bold">${unreadCount}</span>` : ""}
                                    </div>
                                    ${
                                        lastMessage
                                            ? `<p class="text-gray-400 truncate max-w-xs text-sm mt-1">${lastMessage.type === "text" ? lastMessage.text : " Shared an image"}</p>`
                                            : `<p class="text-gray-500 text-sm mt-1">No messages yet</p>`
                                    }
                                    <p class="text-xs text-gray-500 mt-1">${isOnline ? "Online now" : `Last seen ${timeAgo}`}</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <span class="text-xs px-3 py-1 rounded-full font-medium ${isOnline ? "bg-green-500/20 text-green-300 border border-green-500/30" : "bg-gray-500/20 text-gray-400 border border-gray-500/30"}">${friend.status}</span>
                                <svg class="w-5 h-5 text-purple-400 group-hover:text-cyan-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                </svg>
                            </div>
                        </div>
                    `
                })
                .join("")
        }

        function getUnreadCount(friendId) {
            if (!messages[friendId]) return 0
            return messages[friendId].filter((msg) => !msg.read && msg.sender === "friend").length
        }

        function getTimeAgo(date) {
            const now = new Date()
            const diffInSeconds = Math.floor((now - date) / 1000)

            if (diffInSeconds < 60) return "just now"
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`
            return `${Math.floor(diffInSeconds / 86400)}d ago`
        }

        // Enhanced profile management
        function showProfile() {
            document.getElementById("profile-modal").classList.remove("hidden")
            document.getElementById("profile-modal").style.animation = "fadeIn 0.3s ease-out"

            document.getElementById("profile-username").value = currentUser.username
            document.getElementById("profile-bio").value = currentUser.bio || ""
            document.getElementById("profile-id").value = currentUser.id

            updateProfileAvatar()
        }

        function hideProfile() {
            const modal = document.getElementById("profile-modal")
            modal.style.animation = "fadeOut 0.3s ease-out"
            setTimeout(() => modal.classList.add("hidden"), 300)
        }

        function updateProfileAvatar() {
            const profileAvatar = document.getElementById("profile-avatar")
            if (currentUser.avatar) {
                profileAvatar.style.backgroundImage = `url(${currentUser.avatar})`
                profileAvatar.style.backgroundSize = "cover"
                profileAvatar.style.backgroundPosition = "center"
                profileAvatar.textContent = ""
            } else {
                profileAvatar.style.backgroundImage = ""
                profileAvatar.textContent = currentUser.username.charAt(0).toUpperCase()
            }
        }

        function handleProfileUpdate(e) {
            e.preventDefault()

            const newUsername = document.getElementById("profile-username").value.trim()
            const newBio = document.getElementById("profile-bio").value.trim()

            if (!validateUsername(newUsername)) {
                showNotification("Username must be 3-20 characters and contain only letters, numbers, and underscores", "error")
                return
            }

            setButtonLoading(e.target.querySelector('button[type="submit"]'), true)

            setTimeout(() => {
                currentUser.username = newUsername
                currentUser.bio = newBio

                // Update in registered users as well
                if (registeredUsers[currentUser.email]) {
                    registeredUsers[currentUser.email].username = newUsername
                    registeredUsers[currentUser.email].bio = newBio
                    registeredUsers[currentUser.email].avatar = currentUser.avatar
                    saveRegisteredUsers()
                }

                saveUserData()
                updateDashboard()
                updateProfileAvatar()

                setButtonLoading(e.target.querySelector('button[type="submit"]'), false)
                showNotification("Profile updated successfully! ", "success")
                hideProfile()
            }, 1000)
        }

        function updateAvatar(input) {
            const file = input.files[0]
            if (!file) return

            if (file.size > 5 * 1024 * 1024) {
                showNotification("Image size must be less than 5MB", "error")
                return
            }

            const reader = new FileReader()
            reader.onload = (e) => {
                currentUser.avatar = e.target.result

                updateUserAvatar()
                updateProfileAvatar()

                saveUserData()
                showNotification("Avatar updated successfully! ", "success")
            }
            reader.readAsDataURL(file)
        }

        function copyUserId() {
            const userId = document.getElementById("profile-id")
            userId.select()
            document.execCommand("copy")

            const button = event.target.closest("button")
            const originalHTML = button.innerHTML
            button.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
            `
            button.classList.add("bg-green-500")

            setTimeout(() => {
                button.innerHTML = originalHTML
                button.classList.remove("bg-green-500")
            }, 2000)

            showNotification("Cosmic ID copied to clipboard! ", "success")
        }

        // Enhanced friend management with real user lookup
        function showAddFriend() {
            document.getElementById("add-friend-modal").classList.remove("hidden")
            document.getElementById("add-friend-modal").style.animation = "fadeIn 0.3s ease-out"
            document.getElementById("friend-identifier").focus()
        }

        function hideAddFriend() {
            const modal = document.getElementById("add-friend-modal")
            modal.style.animation = "fadeOut 0.3s ease-out"
            setTimeout(() => {
                modal.classList.add("hidden")
                document.getElementById("friend-identifier").value = ""
            }, 300)
        }

        function handleAddFriend(e) {
            e.preventDefault()

            const identifier = document.getElementById("friend-identifier").value.trim()

            if (!identifier) {
                showNotification("Please enter a Cosmic ID", "error")
                return
            }

            if (!identifier.startsWith("cosmic_")) {
                showNotification("Invalid Cosmic ID format. It should start with 'cosmic_'", "error")
                return
            }

            // Check if friend already exists
            const existingFriend = friends.find((f) => f.id === identifier)
            if (existingFriend) {
                showNotification("This cosmic explorer is already your friend! ", "warning")
                return
            }

            // Check if trying to add self
            if (identifier === currentUser.id) {
                showNotification("You cannot add yourself as a friend! ", "warning")
                return
            }

            setButtonLoading(e.target.querySelector('button[type="submit"]'), true)

            // Look for the user in registered users
            setTimeout(() => {
                let foundUser = null
                for (const email in registeredUsers) {
                    if (registeredUsers[email].id === identifier) {
                        foundUser = registeredUsers[email]
                        break
                    }
                }

                if (!foundUser) {
                    setButtonLoading(e.target.querySelector('button[type="submit"]'), false)
                    showNotification("Cosmic ID not found. Make sure your friend has signed up and shared the correct ID! ", "error")
                    return
                }

                const newFriend = {
                    id: foundUser.id,
                    username: foundUser.username,
                    email: foundUser.email,
                    status: Math.random() > 0.5 ? "online" : "offline",
                    avatar: foundUser.avatar,
                    addedDate: new Date().toISOString(),
                    lastSeen: new Date(Date.now() - Math.random() * 86400000).toISOString(),
                    bio: foundUser.bio || "Fellow cosmic explorer! ",
                }

                friends.push(newFriend)
                saveUserData()
                updateDashboard()

                setButtonLoading(e.target.querySelector('button[type="submit"]'), false)
                hideAddFriend()

                showNotification(`${newFriend.username} added to your cosmic friends! `, "success")
            }, 2000)
        }

        // Enhanced chat functionality
        function loadChat(friendId) {
            const friend = friends.find((f) => f.id === friendId)
            if (!friend) return

            currentChat = friend

            document.getElementById("chat-friend-name").textContent = friend.username
            updateChatStatus(friend)

            const chatAvatar = document.getElementById("chat-friend-avatar")
            if (friend.avatar) {
                chatAvatar.style.backgroundImage = `url(${friend.avatar})`
                chatAvatar.style.backgroundSize = "cover"
                chatAvatar.style.backgroundPosition = "center"
                chatAvatar.textContent = ""
            } else {
                chatAvatar.style.backgroundImage = ""
                chatAvatar.textContent = friend.username.charAt(0).toUpperCase()
            }

            loadMessages(friendId)
            markMessagesAsRead(friendId)
            document.getElementById("message-input").focus()
        }

        function updateChatStatus(friend) {
            const statusText = document.getElementById("chat-friend-status-text")
            const statusIndicator = document.getElementById("chat-friend-status")
            const isOnline = friend.status === "online"

            statusText.textContent = isOnline ? "online" : `last seen ${getTimeAgo(new Date(friend.lastSeen))}`
            statusText.className = `text-sm px-3 py-1 rounded-full font-medium ${isOnline ? "text-green-300 bg-green-500/20 border border-green-500/30" : "text-gray-400 bg-gray-500/20 border border-gray-500/30"}`
            statusIndicator.className = `absolute -bottom-1 -right-1 w-4 h-4 border-3 border-black rounded-full ${isOnline ? "status-online" : "status-offline"}`
        }

        function loadMessages(friendId) {
            const container = document.getElementById("messages-container")
            const friendMessages = messages[friendId] || []

            if (friendMessages.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-16">
                        <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-purple-500/20 to-cyan-500/20 rounded-3xl flex items-center justify-center">
                            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Start your cosmic conversation</h3>
                        <p class="text-lg">Send your first message to ${currentChat.username}!</p>
                    </div>
                `
                return
            }

            container.innerHTML = friendMessages
                .map((message, index) => {
                    const isUser = message.sender === "user"
                    const time = new Date(message.timestamp).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })

                    if (message.type === "image") {
                        return `
                            <div class="flex ${isUser ? "justify-end" : "justify-start"} message-bubble" style="animation-delay: ${index * 0.1}s">
                                <div class="max-w-sm lg:max-w-md">
                                    <div class="p-3 rounded-2xl ${isUser ? "message-user" : "message-friend"}">
                                        <img src="${message.image}" alt="Shared image" class="rounded-xl max-w-full h-auto cursor-pointer hover:scale-105 transition-transform" onclick="openImageModal('${message.image}')">
                                    </div>
                                    <div class="flex items-center ${isUser ? "justify-end" : "justify-start"} mt-2 space-x-2">
                                        <p class="text-xs text-gray-400">${time}</p>
                                        ${isUser && message.read ? '<svg class="w-3 h-3 text-cyan-400" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>' : ""}
                                    </div>
                                </div>
                            </div>
                        `
                    } else {
                        return `
                            <div class="flex ${isUser ? "justify-end" : "justify-start"} message-bubble" style="animation-delay: ${index * 0.1}s">
                                <div class="max-w-sm lg:max-md">
                                    <div class="p-4 rounded-2xl ${isUser ? "message-user text-white" : "message-friend text-white"}">
                                        <p class="text-sm leading-relaxed">${escapeHtml(message.text)}</p>
                                    </div>
                                    <div class="flex items-center ${isUser ? "justify-end" : "justify-start"} mt-2 space-x-2">
                                        <p class="text-xs text-gray-400">${time}</p>
                                        ${isUser && message.read ? '<svg class="w-3 h-3 text-cyan-400" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>' : ""}
                                    </div>
                                </div>
                            </div>
                        `
                    }
                })
                .join("")

            setTimeout(() => {
                container.scrollTop = container.scrollHeight
            }, 100)
        }

        function markMessagesAsRead(friendId) {
            if (messages[friendId]) {
                messages[friendId].forEach((msg) => {
                    if (msg.sender === "friend") {
                        msg.read = true
                    }
                })
                saveUserData()
                updateDashboard()
            }
        }

        function sendMessage() {
            const input = document.getElementById("message-input")
            const text = input.value.trim()

            if (!text || !currentChat) return

            const message = {
                id: Date.now().toString(),
                text: text,
                sender: "user",
                timestamp: new Date().toISOString(),
                type: "text",
                read: true,
            }

            if (!messages[currentChat.id]) {
                messages[currentChat.id] = []
            }
            messages[currentChat.id].push(message)

            input.value = ""
            loadMessages(currentChat.id)
            saveUserData()

            setTimeout(() => {
                simulateFriendResponse()
            }, 1000 + Math.random() * 2000)
        }

        function sendImage(input) {
            const file = input.files[0]
            if (!file || !currentChat) return

            if (file.size > 10 * 1024 * 1024) {
                showNotification("Image size must be less than 10MB", "error")
                return
            }

            const reader = new FileReader()
            reader.onload = (e) => {
                const message = {
                    id: Date.now().toString(),
                    image: e.target.result,
                    sender: "user",
                    timestamp: new Date().toISOString(),
                    type: "image",
                    read: true,
                }

                if (!messages[currentChat.id]) {
                    messages[currentChat.id] = []
                }
                messages[currentChat.id].push(message)

                loadMessages(currentChat.id)
                saveUserData()

                setTimeout(() => {
                    const imageResponses = [
                        "Wow, amazing photo! ",
                        "That's incredible! ",
                        "Beautiful shot! ",
                        "Love this! ",
                        "Thanks for sharing! ",
                    ]
                    simulateFriendResponse(imageResponses[Math.floor(Math.random() * imageResponses.length)])
                }, 2000)
            }
            reader.readAsDataURL(file)

            input.value = ""
        }

        function simulateFriendResponse(customText = null) {
            if (!currentChat) return

            document.getElementById("typing-indicator").classList.remove("hidden")

            setTimeout(() => {
                document.getElementById("typing-indicator").classList.add("hidden")

                const responses = [
                    "That's awesome! ",
                    "I totally agree with you!",
                    "Haha, you're so funny! ",
                    "Tell me more about that!",
                    "That sounds amazing! ",
                    "I love exploring the cosmos with you! ",
                    "Wow, that's incredible!",
                    "Thanks for sharing that! ",
                    "You always have the best ideas! ",
                    "That's so cool! ",
                    "",
                    "I'm excited about this! ",
                ]

                const responseText = customText || responses[Math.floor(Math.random() * responses.length)]

                const friendMessage = {
                    id: (Date.now() + 1).toString(),
                    text: responseText,
                    sender: "friend",
                    timestamp: new Date().toISOString(),
                    type: "text",
                    read: false,
                }

                messages[currentChat.id].push(friendMessage)
                loadMessages(currentChat.id)
                saveUserData()
            }, 1500 + Math.random() * 1000)
        }

        function simulateTypingIndicator() {
            if (!currentChat) return

            const indicator = document.getElementById("typing-indicator")
            indicator.classList.remove("hidden")

            setTimeout(() => {
                indicator.classList.add("hidden")
            }, 3000)
        }

        function backToDashboard() {
            currentChat = null
            showDashboard()
        }

        // Enhanced calling functionality with WebRTC
        function startVoiceCall() {
            if (!currentChat) return

            showNotification(`Starting voice call with ${currentChat.username}... `, "info")
            
            // Show incoming call notification for demo
            setTimeout(() => {
                showIncomingCall(currentChat.username, 'voice')
            }, 2000)
        }

        function startVideoCall() {
            if (!currentChat) return

            showNotification(`Initiating video call with ${currentChat.username}... `, "info")
            
            // Initialize WebRTC
            initializeWebRTC()
            
            document.getElementById("video-call-overlay").classList.remove("hidden")
            document.getElementById("video-call-overlay").style.animation = "fadeIn 0.5s ease-out"
            document.getElementById("remote-video-label").textContent = currentChat.username

            isInCall = true
            callStartTime = Date.now()
            startCallTimer()

            navigator.mediaDevices
                .getUserMedia({
                    video: { width: 1280, height: 720 },
                    audio: { echoCancellation: true, noiseSuppression: true },
                })
                .then((stream) => {
                    localStream = stream
                    document.getElementById("local-video").srcObject = stream
                    showNotification(`Video call connected with ${currentChat.username} `, "success")
                })
                .catch((err) => {
                    console.error("Error accessing media devices:", err)
                    showNotification("Could not access camera/microphone. Please check permissions.", "error")
                    endCall()
                })
        }

        function showIncomingCall(callerName, type = 'video') {
            document.getElementById("caller-name").textContent = callerName
            document.getElementById("incoming-call").classList.remove("hidden")
            
            // Auto-decline after 30 seconds
            setTimeout(() => {
                if (!document.getElementById("incoming-call").classList.contains("hidden")) {
                    declineCall()
                }
            }, 30000)
        }

        function acceptCall() {
            document.getElementById("incoming-call").classList.add("hidden")
            startVideoCall()
        }

        function declineCall() {
            document.getElementById("incoming-call").classList.add("hidden")
            showNotification("Call declined", "info")
        }

        function endCall() {
            isInCall = false

            if (localStream) {
                localStream.getTracks().forEach((track) => track.stop())
                localStream = null
            }

            if (peerConnection) {
                peerConnection.close()
                peerConnection = null
            }

            if (callTimer) {
                clearInterval(callTimer)
                callTimer = null
            }

            const overlay = document.getElementById("video-call-overlay")
            overlay.style.animation = "fadeOut 0.5s ease-out"
            setTimeout(() => {
                overlay.classList.add("hidden")
                document.getElementById("call-timer").textContent = "00:00"
            }, 500)

            showNotification("Call ended ", "info")
        }

        function startCallTimer() {
            callTimer = setInterval(() => {
                if (!isInCall) return

                const elapsed = Math.floor((Date.now() - callStartTime) / 1000)
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, "0")
                const seconds = (elapsed % 60).toString().padStart(2, "0")

                document.getElementById("call-timer").textContent = `${minutes}:${seconds}`
            }, 1000)
        }

        function toggleMute() {
            if (!localStream) return

            const audioTrack = localStream.getAudioTracks()[0]
            if (audioTrack) {
                audioTrack.enabled = !audioTrack.enabled
                const muteBtn = document.getElementById("mute-btn")

                if (audioTrack.enabled) {
                    muteBtn.innerHTML = `
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                        </svg>
                    `
                    muteBtn.className = "bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-2xl transition-all duration-300 hover:scale-110 call-button"
                    showNotification("Microphone unmuted ", "info")
                } else {
                    muteBtn.innerHTML = `
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"/>
                        </svg>
                    `
                    muteBtn.className = "bg-red-500 hover:bg-red-600 text-white p-4 rounded-2xl transition-all duration-300 hover:scale-110 call-button"
                    showNotification("Microphone muted ", "info")
                }
            }
        }

        function toggleVideo() {
            if (!localStream) return

            const videoTrack = localStream.getVideoTracks()[0]
            if (videoTrack) {
                videoTrack.enabled = !videoTrack.enabled
                const videoBtn = document.getElementById("video-btn")

                if (videoTrack.enabled) {
                    videoBtn.innerHTML = `
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                    `
                    videoBtn.className = "bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-2xl transition-all duration-300 hover:scale-110 call-button"
                    showNotification("Camera enabled ", "info")
                } else {
                    videoBtn.innerHTML = `
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"/>
                        </svg>
                    `
                    videoBtn.className = "bg-red-500 hover:bg-red-600 text-white p-4 rounded-2xl transition-all duration-300 hover:scale-110 call-button"
                    showNotification("Camera disabled ", "info")
                }
            }
        }

        // Initialize WebRTC for real-time communication
        function initializeWebRTC() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                console.warn("WebRTC not supported in this browser")
                return
            }

            // Create RTCPeerConnection
            const configuration = {
                iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:stun1.l.google.com:19302' }
                ]
            }

            peerConnection = new RTCPeerConnection(configuration)

            // Handle remote stream
            peerConnection.ontrack = (event) => {
                remoteStream = event.streams[0]
                document.getElementById("remote-video").srcObject = remoteStream
            }

            // Handle ICE candidates
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    // In a real app, send this to the remote peer
                    console.log('ICE candidate:', event.candidate)
                }
            }

            console.log("WebRTC initialized successfully")
        }

        // Enhanced utility functions
        function showNotification(message, type = "info") {
            const notification = document.createElement("div")
            notification.className = `notification fixed top-6 right-6 z-50 p-6 rounded-2xl shadow-2xl transition-all duration-500 transform translate-x-full max-w-sm`

            const icons = {
                success: "M5 13l4 4L19 7",
                error: "M6 18L18 6M6 6l12 12",
                warning: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z",
                info: "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
            }

            const colors = {
                success: "bg-green-500/90 text-white border border-green-400",
                error: "bg-red-500/90 text-white border border-red-400",
                warning: "bg-yellow-500/90 text-black border border-yellow-400",
                info: "bg-blue-500/90 text-white border border-blue-400",
            }

            notification.className += ` ${colors[type]}`
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${icons[type]}"/>
                    </svg>
                    <p class="font-medium">${message}</p>
                </div>
            `

            document.body.appendChild(notification)

            setTimeout(() => {
                notification.classList.remove("translate-x-full")
            }, 100)

            setTimeout(() => {
                notification.classList.add("translate-x-full")
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification)
                    }
                }, 500)
            }, 4000)
        }

        function setButtonLoading(button, loading) {
            if (loading) {
                button.disabled = true
                button.dataset.originalText = button.innerHTML
                button.innerHTML = `
                    <div class="flex items-center justify-center">
                        <div class="loading-spinner mr-3"></div>
                        Processing...
                    </div>
                `
            } else {
                button.disabled = false
                button.innerHTML = button.dataset.originalText
            }
        }

        function escapeHtml(text) {
            const div = document.createElement("div")
            div.textContent = text
            return div.innerHTML
        }

        function openImageModal(imageSrc) {
            const modal = document.createElement("div")
            modal.className = "fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4"
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <img src="${imageSrc}" class="max-w-full max-h-full rounded-2xl" alt="Full size image">
                    <button onclick="this.closest('.fixed').remove()" class="absolute top-4 right-4 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            `
            document.body.appendChild(modal)
            modal.style.animation = "fadeIn 0.3s ease-out"
        }

        // Auto-save user data periodically
        setInterval(() => {
            if (currentUser) {
                saveUserData()
            }
        }, 30000)
    </script>
</body>
</html>
